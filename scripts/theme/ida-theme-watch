#!/usr/bin/env bash
# IDA Theme Watcher
# Monitors hyprpaper.conf for changes and regenerates theme automatically

set -euo pipefail

readonly REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
readonly HYPRPAPER_CONF="$REPO_ROOT/config/hypr/hyprpaper.conf"

if ! command -v inotifywait >/dev/null 2>&1; then
    echo "Error: inotifywait not found. Please install inotify-tools" >&2
    exit 1
fi

if [[ ! -f "$HYPRPAPER_CONF" ]]; then
    echo "Error: hyprpaper.conf not found: $HYPRPAPER_CONF" >&2
    exit 1
fi

echo "Watching for wallpaper changes: $HYPRPAPER_CONF"

while inotifywait -e modify,close_write "$HYPRPAPER_CONF" >/dev/null 2>&1; do
    echo "Wallpaper changed, regenerating theme..."
    "$REPO_ROOT/scripts/theme/ida-theme"
done
